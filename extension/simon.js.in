var messageIdCounter = 1

function makeTransportPackage(message) {
  return {
    id: messageIdCounter++
    , message: message
    , timestamp: new Date().toISOString()
  }
}

function makeRequest(module, method, data) {
  return {
    id: messageIdCounter++
    , module: module
    , method: method
    , data: data
    , timestamp: new Date().toISOString()
  }
}

var port = chrome.runtime.connectNative("@PROJECT_NAME@");

port.onMessage.addListener(function(message) {
  console.log(message);
});

port.onDisconnect.addListener(function() {
  console.log("Disconnected from @PROJECT_NAME@");
});

var simonSays = function(message) {
  port.postMessage(makeTransportPackage(message));
}

var simonCall = function(module, method, data) {
  port.postMessage(makeRequest(module, method, data));
}
